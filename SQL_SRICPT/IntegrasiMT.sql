--08/05/2020 run on uat
--07/05/2020 run on local
ALTER TABLE TBLINTMTPENDAFTARAN ADD UMUR NUMBER;
ALTER TABLE TBLINTMTPENDAFTARAN ADD JANTINA VARCHAR2(2);


--08/05/2020 run on uat
--06/05/2020 run on local
CREATE OR REPLACE VIEW VPPT_PTGPTD
	(ID_PERMOHONAN,ID_PEJABAT,NAMA_PEJABAT)
AS
SELECT ID_PERMOHONAN,ID_PEJABAT,NAMA_PEJABAT
FROM 
(SELECT P.ID_PERMOHONAN,RP.* FROM TBLRUJPEJABAT RP, TBLPPTPERMOHONAN P
WHERE 
--
P.ID_PEJABAT_PTG = RP.ID_PEJABAT
UNION
SELECT P.ID_PERMOHONAN,RP.* FROM TBLRUJPEJABAT RP, TBLPPTPERMOHONAN P
WHERE 
--
P.ID_PEJABAT_PTD = RP.ID_PEJABAT
) P
ORDER BY NAMA_PEJABAT 

--30/04/2020 run on STAGING
RALAT SQL :ORA-02260: table can have only one primary key 
-- 29/04/2020
 ALTER TABLE TBLINTMTPENDAFTARAN ADD CONSTRAINT INTMTPENDAFTARAN_PK PRIMARY KEY (ID_PENDAFTARAN) ENABLE;

-- Mula 18/03/3020

 CREATE OR REPLACE TRIGGER TBLINTMTPENDAFTARANDOK_BI    
before insert on     TBLINTMTPENDAFTARANDOK   for each row
begin    if :new.ID_PENDAFTARANDOK   is null    then SELECT (SELECT kod_negeri FROM tbllookupstate) || TO_CHAR (SYSDATE, 'YY') || TBLINTMTPENDAFTARANDOK_SEQ.NEXTVAL into :new.ID_PENDAFTARANDOK          from dual;    end if;    end;
/

-- 
CREATE SEQUENCE TBLINTMTPENDAFTARANDOK_SEQ
  START WITH 1
  MAXVALUE 999999999
  MINVALUE 1
  NOCYCLE
  NOCACHE
  ORDER;
 
  CREATE TABLE TBLINTMTPENDAFTARANDOK (
    ID_PENDAFTARANDOK NUMBER NOT NULL ENABLE, 
	ID_RUJUKAN NUMBER, 
	ID_DOKUMEN NUMBER, 
  	TARIKH_MASUK DATE,
  	ID_MASUK NUMBER(16,0),
  	TARIKH_KEMASKINI DATE,
  	ID_KEMASKINI NUMBER(16,0),
	CONSTRAINT INTMTPENDAFTARANDOK_PK PRIMARY KEY (ID_PENDAFTARANDOK)
 );

INSERT INTO TBLINTMTLOCATIONMAP
(ID_LOCATIONMAP, ID_LOCATION, ID_PEJABAT, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99201, 99201, 95, NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATIONMAP
(ID_LOCATIONMAP, ID_LOCATION, ID_PEJABAT, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99202, 99202, 15, NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATIONMAP
(ID_LOCATIONMAP, ID_LOCATION, ID_PEJABAT, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99203, 99203, 71, NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATIONMAP
(ID_LOCATIONMAP, ID_LOCATION, ID_PEJABAT, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99204, 99204, 83, NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATIONMAP
(ID_LOCATIONMAP, ID_LOCATION, ID_PEJABAT, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99205, 99205, 181, NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATIONMAP
(ID_LOCATIONMAP, ID_LOCATION, ID_PEJABAT, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99206, 99206, 107, NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATIONMAP
(ID_LOCATIONMAP, ID_LOCATION, ID_PEJABAT, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99207, 99207, 142, NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATIONMAP
(ID_LOCATIONMAP, ID_LOCATION, ID_PEJABAT, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99208, 99208, 311, NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATIONMAP
(ID_LOCATIONMAP, ID_LOCATION, ID_PEJABAT, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99209, 99209, 39, NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATIONMAP
(ID_LOCATIONMAP, ID_LOCATION, ID_PEJABAT, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(992010, 992010, 160, NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATIONMAP
(ID_LOCATIONMAP, ID_LOCATION, ID_PEJABAT, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(992011, 992011, 12, NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATIONMAP
(ID_LOCATIONMAP, ID_LOCATION, ID_PEJABAT, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(992012, 992012, 59, NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATIONMAP
(ID_LOCATIONMAP, ID_LOCATION, ID_PEJABAT, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(992013, 992013, 174, NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATIONMAP
(ID_LOCATIONMAP, ID_LOCATION, ID_PEJABAT, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(992014, 992014, 117, NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATIONMAP
(ID_LOCATIONMAP, ID_LOCATION, ID_PEJABAT, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(992015, 992015, 28, NULL, NULL, NULL, NULL);


 CREATE OR REPLACE TRIGGER TBLINTMTLOCATIONMAP_BI    
before insert on     TBLINTMTLOCATIONMAP   for each row
begin    if :new.ID_LOCATIONMAP   is null    then SELECT (SELECT kod_negeri FROM tbllookupstate) || TO_CHAR (SYSDATE, 'YY') || TBLINTMTLOCATIONMAP_SEQ.NEXTVAL into :new.ID_LOCATIONMAP          from dual;    end if;    end;
/

-- 
CREATE SEQUENCE TBLINTMTLOCATIONMAP_SEQ
  START WITH 1
  MAXVALUE 999999999
  MINVALUE 1
  NOCYCLE
  NOCACHE
  ORDER;
 
  CREATE TABLE TBLINTMTLOCATIONMAP (
    ID_LOCATIONMAP NUMBER NOT NULL ENABLE, 
	ID_LOCATION NUMBER, 
	ID_PEJABAT NUMBER, 
  	TARIKH_MASUK DATE,
  	ID_MASUK NUMBER(16,0),
  	TARIKH_KEMASKINI DATE,
  	ID_KEMASKINI NUMBER(16,0),
	CONSTRAINT INTMTLOCATIONMAP_PK PRIMARY KEY (ID_LOCATIONMAP)
 );

INSERT INTO TBLINTMTLOCATION
(ID_LOCATION, LOCATION, NAME, CODE, FLAG_AKTIF, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99201, 1, NULL, 'RA', 'Y', NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATION
(ID_LOCATION, LOCATION, NAME, CODE, FLAG_AKTIF, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99202, 2, NULL, 'KA', 'Y', NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATION
(ID_LOCATION, LOCATION, NAME, CODE, FLAG_AKTIF, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99203, 13, NULL, 'PA', 'Y', NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATION
(ID_LOCATION, LOCATION, NAME, CODE, FLAG_AKTIF, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99204, 18, NULL, 'AA', 'Y', NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATION
(ID_LOCATION, LOCATION, NAME, CODE, FLAG_AKTIF, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99205, 19, NULL, 'AB', 'Y', NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATION
(ID_LOCATION, LOCATION, NAME, CODE, FLAG_AKTIF, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99206, 33, NULL, 'BA', 'Y', NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATION
(ID_LOCATION, LOCATION, NAME, CODE, FLAG_AKTIF, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99207, 51, NULL, 'WA', 'Y', NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATION
(ID_LOCATION, LOCATION, NAME, CODE, FLAG_AKTIF, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99208, 52, NULL, 'NA', 'Y', NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATION
(ID_LOCATION, LOCATION, NAME, CODE, FLAG_AKTIF, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(99209, 60, NULL, 'MA', 'Y', NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATION
(ID_LOCATION, LOCATION, NAME, CODE, FLAG_AKTIF, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(992010, 63, NULL, 'JA', 'Y', NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATION
(ID_LOCATION, LOCATION, NAME, CODE, FLAG_AKTIF, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(992011, 64, NULL, 'JB', 'Y', NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATION
(ID_LOCATION, LOCATION, NAME, CODE, FLAG_AKTIF, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(992012, 74, NULL, 'CA', 'Y', NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATION
(ID_LOCATION, LOCATION, NAME, CODE, FLAG_AKTIF, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(992013, 75, NULL, 'CB', 'Y', NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATION
(ID_LOCATION, LOCATION, NAME, CODE, FLAG_AKTIF, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(992014, 84, NULL, 'TA', 'Y', NULL, NULL, NULL, NULL);
INSERT INTO TBLINTMTLOCATION
(ID_LOCATION, LOCATION, NAME, CODE, FLAG_AKTIF, TARIKH_MASUK, ID_MASUK, TARIKH_KEMASKINI, ID_KEMASKINI)
VALUES(992015, 91, NULL, 'DA', 'Y', NULL, NULL, NULL, NULL);

 CREATE OR REPLACE TRIGGER TBLINTMTLOCATION_BI    
before insert on     TBLINTMTLOCATION   for each row
begin    if :new.ID_LOCATION   is null    then SELECT (SELECT kod_negeri FROM tbllookupstate) || TO_CHAR (SYSDATE, 'YY') || TBLINTMTLOCATION_SEQ.NEXTVAL into :new.ID_LOCATION          from dual;    end if;    end;
/

-- 
CREATE SEQUENCE TBLINTMTLOCATION_SEQ
  START WITH 1
  MAXVALUE 999999999
  MINVALUE 1
  NOCYCLE
  NOCACHE
  ORDER;

  --30/04/2020 run on STAGING
CREATE TABLE TBLINTMTLOCATION (
    ID_LOCATION NUMBER NOT NULL ENABLE, 
	LOCATION NUMBER, 
	NAME VARCHAR2(50), 
	CODE VARCHAR2(5), 
	FLAG_AKTIF VARCHAR2(1) DEFAULT 'Y', 
  	TARIKH_MASUK DATE,
  	ID_MASUK NUMBER(16,0),
  	TARIKH_KEMASKINI DATE,
  	ID_KEMASKINI NUMBER(16,0),
	CONSTRAINT INTMTLOCATION_PK PRIMARY KEY (ID_LOCATION)
 );


-- Tamat 18/03/3020

-- 2020/04/13 (ekptghqfat)
-- 06/03/3020, run on ekptghqtest 
 CREATE OR REPLACE TRIGGER TBLINTMTPENDAFTARAN_BI    
before insert on     TBLINTMTPENDAFTARAN    for each row
begin    if :new.ID_PENDAFTARAN   is null    then SELECT (SELECT kod_negeri FROM tbllookupstate) || TO_CHAR (SYSDATE, 'YY') || TBLINTMTPENDAFTARAN_SEQ.NEXTVAL into :new.ID_PENDAFTARAN          from dual;    end if;    end;
/
-- 06/03/3020
CREATE SEQUENCE TBLINTMTPENDAFTARAN_SEQ
  START WITH 1
  MAXVALUE 999999999
  MINVALUE 1
  NOCYCLE
  NOCACHE
  ORDER;

 -- MULA 08/05/2020 UAT
 -- 18/04/2020
 ALTER TABLE TBLINTMTPENDAFTARAN MODIFY JENIS_TRANSAKSI VARCHAR2(10);
 
ALTER TABLE TBLINTMTPENDAFTARAN ADD ID_RUJUKAN NUMBER;
referenceNo
ALTER TABLE TBLINTMTPENDAFTARAN MODIFY KOD_MT VARCHAR2(2);

ALTER TABLE TBLINTMTPENDAFTARAN RENAME COLUMN KODPEJABAT TO KOD_MT;
-- END 08/05/2020 UAT

--SELECT * FROM TBLINTMTPENDAFTARAN

-- 06/03/3020
  CREATE TABLE TBLINTMTPENDAFTARAN (
    ID_PENDAFTARAN NUMBER NOT NULL ENABLE, 
	ID_FAIL NUMBER, 
	NO_FAIL VARCHAR2(50), 
	NOKP_BARU VARCHAR2(15), 
	NOKP_LAMA VARCHAR2(50), 
	NOKP_LAIN VARCHAR2(50), 
	TARIKH_DAFTARKES DATE, 
	NO_KES VARCHAR2(200), 
	KODPEJABAT VARCHAR2(10), 
	JENIS_TRANSAKSI VARCHAR2(1), 
	CATATAN VARCHAR2(250), 
	TARIKH_HANTAR DATE, 
	FLAG_AKTIF VARCHAR2(1) DEFAULT 'Y', 
	ID_TRANSAKSI VARCHAR2(100), 
	ID_PENDAFTARANSTR VARCHAR2(20), 
  TARIKH_MASUK DATE,
  ID_MASUK NUMBER(16,0),
  TARIKH_KEMASKINI DATE,
  ID_KEMASKINI NUMBER(16,0),
CONSTRAINT INTMTPENDAFTARAN_PK PRIMARY KEY (ID_PENDAFTARAN)
 );

select * from TBLINTMTPENDAFTARAN